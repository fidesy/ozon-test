# ozon-test
Решение тестового задания на позицию Golang стажера-разработчика.

### Результат работы

---
Сервер принимает два запроса:

**GET /:hash** - получение оригинальной ссылки по сокращенной

Возможные ответы:
    
* 200 (OK) - хэш успешно найден, оригинальная ссылка возвращена
* 404 (NotFound) - хэш не найден
* 500 (InternalServerError) - ошибка сервера


**POST /api/create** - создание сокращенной ссылки

Возможные ответы:

* 201 (Created) - сокращенная ссылка успешно создана
* 400 (BadRequest) - клиент предоставил невалидное тело запроса / ссылку
* 409 (Conflict) - данная ссылка уже существует
* 500 (InternalServerError) - ошибка сервера

---
**_Алгоритм генерации сокращенных ссылок_**
1. Вычисление хэш-суммы MD5 исходной ссылки.
2. Преобразование хэша в строку с использованием кодирования base64.
3. Замена знаков (/+) на _ в полученной строке по условию задачи.
4. Строка обрезается до длины в 10 символов.

Что насчет коллизий?

В случае возникновения коллизий используется простой алгоритм - добавление вычисленного хэша к исходной ссылке в цикле пока не найдется уникальный хэш. Довольно наивный алгоритм, но самое главное, что выполняется условие идемпотентности.

---

### Структура проекта

```
├── .github/             
     └── workflows/
         └── main.yml             # конфигурационный файл для Github Actions
├── cmd/ozon-test/
         └── main.go              # entrypoint - запуск приложения
├── configs/config.yml            # конфигурационные параметры сервиса
├── internal/
    ├── config/config.go          # структуры для хранения конфига    
    ├── delivery/
        ├── grpc/                 # grpc сервис 
        └── handler/              # rest api 
    ├── domain/url.go             # описание структуры и поведения сущности
    ├── infrastructure/
        ├── dberrors/   
        └── persistence/
            ├── inmemory/         # in-memory решение
            ├── postgres/         # взаимодействие с PostgreSQL
            └── repository.go     # фабричный метод для создания баз данных
    └── service/
        ├── url.go                # реализация поведения сущности url
        └── service.go               
├── pkg/utils/
        └── generate_short_url.go # алгоритм генерации сокращенной ссылки
├── go.mod                        # зависимости проекта    
├── migrations                    # схемы таблиц базы данных
└── Makefile                     
```

### Установка

1. Клонировать репозиторий.
```
git clone https://github.com/fidesy/ozon-test.git
cd ozon-test
```

2. Создать файл .env, содержащий переменные для создания контейнера базы данных с помощью docker-compose
```
cp .env.example .env
``` 

3. Выбрать необходимую базу данных [./configs/config.yaml](./configs/config.yml#4) 
поле *database*, опции: postgres, in-memory

4. Запустить приложение.
```
docker compose up -d
```

### Использование 

**REST API**

Создание сокращенной ссылки
```bash
curl -X POST -d '{"original_url": "https://ozon.ru"}' "http://localhost:8000/api/create"

# {"short_url":"http://localhost:8000/WkLSvXb94k"}
```

Получение оригинальной ссылки
```bash
curl http://localhost:8000/WkLSvXb94k

# {"original_url":"https://ozon.ru"}
```